<!-- ============================================================================
     PROFILE PAGE - Página de perfil del usuario

     Secciones:
     - Botón volver
     - Card de perfil con avatar, botones de acción
     - Presentación (bio)
     - Región favorita
     ============================================================================ -->

<main class="profile-page">

  <!-- ========== HEADER: VOLVER Y EDITAR (móvil) ========== -->
  <section class="profile-page__header">
    <button class="profile-page__back-btn" (click)="goBack()">
      <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Volver
    </button>
    <!-- Botón editar solo visible en móvil -->
    <button class="profile-page__edit-btn profile-page__edit-btn--mobile" routerLink="/settings">
      Editar perfil
    </button>
  </section>

  <!-- ========== CARD PRINCIPAL ========== -->
  <section class="profile-card">
    <div class="profile-card__container">

      <!-- Parte superior: Avatar y botones -->
      <div class="profile-card__top">

        <!-- Avatar y datos del usuario -->
        <div class="profile-card__user-info">
          <div class="profile-card__avatar-wrapper">
            <div class="profile-card__avatar" (click)="onAvatarClick()">
              @if (user.avatar) {
                <img [src]="user.avatar" [alt]="user.displayName" class="profile-card__avatar-img">
              } @else {
                <svg class="profile-card__avatar-placeholder" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
              }
            </div>
          </div>
          <div class="profile-card__names">
            <h1 class="profile-card__username">{{ user.username }}</h1>
            <p class="profile-card__display-name">{{ user.displayName }}</p>
          </div>
        </div>

        <!-- Botón editar solo visible en desktop -->
        <button class="profile-page__edit-btn profile-page__edit-btn--desktop" routerLink="/settings">
          Editar perfil
        </button>

      </div>

      <!-- Bio -->
      <div class="profile-card__section profile-card__section--no-title">
        <div class="profile-card__bio-container">
          @if (isEditing) {
            <textarea
              class="profile-card__bio-input"
              [(ngModel)]="editedBio"
              rows="4"
              placeholder="Escribe algo sobre ti...">
            </textarea>
            <div class="profile-card__bio-actions">
              <button class="profile-card__bio-btn profile-card__bio-btn--cancel" (click)="cancelEdit()">
                Cancelar
              </button>
              <button class="profile-card__bio-btn profile-card__bio-btn--save" (click)="saveBio()">
                Guardar
              </button>
            </div>
          } @else {
            <p class="profile-card__bio">{{ user.bio }}</p>
          }
        </div>
      </div>

      <!-- Región favorita -->
      <div class="profile-card__section">
        <h2 class="profile-card__section-title">Mi región favorita</h2>
        <div class="profile-card__region-container">
          @if (user.favoriteRegion) {
            <span class="profile-card__region">{{ user.favoriteRegion }}</span>
          } @else {
            <span class="profile-card__region profile-card__region--empty">Sin seleccionar</span>
          }
        </div>
      </div>

      <!-- Pokémon favoritos -->
      <div id="favoritos" class="profile-card__section">
        <div class="profile-card__section-header">
          <h2 class="profile-card__section-title">Mis Pokémon favoritos</h2>
          @if (favoritePokemon.length > 0) {
            <button
              class="profile-card__download-btn"
              (click)="downloadFavoritesPDF()"
              type="button">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              Descargar
            </button>
          }
        </div>
        @if (favoritePokemon.length === 0) {
          <div class="profile-card__favorites-empty">
            <p class="profile-card__favorites-empty-text">No tienes ningún Pokémon favorito. Que pena.</p>
          </div>
        } @else {
          <div class="profile-card__favorites-grid">
            @for (pokemon of favoritePokemon; track pokemon.id) {
              <div class="profile-card__favorite-item" (click)="navigateToPokemon(pokemon.id)">
                <div class="profile-card__favorite-image-wrapper">
                  <img [src]="pokemon.image" [alt]="pokemon.name" class="profile-card__favorite-image">
                </div>
                <span class="profile-card__favorite-name">{{ pokemon.name }}</span>
              </div>
            }
          </div>
        }
      </div>

    </div>
  </section>

</main>
