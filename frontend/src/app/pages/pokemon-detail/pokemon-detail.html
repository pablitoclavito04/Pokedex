<!-- ============================================================================
     POKEMON DETAIL PAGE - Página de detalle del Pokémon

     Secciones:
     - Navegación superior (anterior/siguiente)
     - Nombre y número
     - Imagen y datos básicos
     - Estadísticas base
     - Evoluciones
     ============================================================================ -->

<main class="pokemon-detail">

  <!-- ========== NAVEGACIÓN SUPERIOR ========== -->
  @if (!fromHome) {
    <nav class="pokemon-nav" aria-label="Navegación entre Pokémon">
      <button class="pokemon-nav__btn pokemon-nav__btn--prev" (click)="goToPrevious()" aria-label="Ver Pokémon anterior">
        <span class="pokemon-nav__arrow">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </span>
        @if (previousPokemon) {
          <span class="pokemon-nav__info">
            <span class="pokemon-nav__id">N.º {{ previousPokemon.id.toString().padStart(4, '0') }}</span>
            <span class="pokemon-nav__name">{{ previousPokemon.name }}</span>
          </span>
        }
      </button>

      <button class="pokemon-nav__btn pokemon-nav__btn--next" (click)="goToNext()" aria-label="Ver Pokémon siguiente">
        @if (nextPokemon) {
          <span class="pokemon-nav__info">
            <span class="pokemon-nav__name">{{ nextPokemon.name }}</span>
            <span class="pokemon-nav__id">N.º {{ nextPokemon.id.toString().padStart(4, '0') }}</span>
          </span>
        }
        <span class="pokemon-nav__arrow">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </span>
      </button>
    </nav>
  }

  <!-- ========== ENCABEZADO CON NOMBRE ========== -->
  <header class="pokemon-header">
    <h1 class="pokemon-header__title">
      <span class="pokemon-header__name">{{ pokemon.name }}</span>
      <span class="pokemon-header__id">{{ formatPokemonId(pokemon.id) }}</span>
    </h1>
    <button class="pokemon-header__share-btn" (click)="openShareModal()" type="button" aria-label="Compartir este Pokémon">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <circle cx="18" cy="5" r="3"/>
        <circle cx="6" cy="12" r="3"/>
        <circle cx="18" cy="19" r="3"/>
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
      </svg>
      Compartir
    </button>
  </header>

  <!-- ========== MODAL COMPARTIR ========== -->
  @if (showShareModal) {
    <div class="share-modal-overlay" (click)="closeShareModal()" role="dialog" aria-modal="true" aria-labelledby="share-modal-title">
      <div class="share-modal" (click)="$event.stopPropagation()">
        <button class="share-modal__close" (click)="closeShareModal()" type="button" aria-label="Cerrar modal">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
        <h3 class="share-modal__title" id="share-modal-title">Compartir Pokémon</h3>
        <p class="share-modal__subtitle">Comparte este Pokémon con tus amigos</p>
        <div class="share-modal__url-container">
          <label for="share-url" class="sr-only">URL para compartir</label>
          <input
            type="text"
            id="share-url"
            class="share-modal__url-input"
            [value]="shareUrl"
            readonly>
          <button
            class="share-modal__copy-btn"
            [class.share-modal__copy-btn--success]="copySuccess"
            (click)="copyShareUrl()"
            type="button">
            {{ copySuccess ? '¡Copiado!' : 'Copiar' }}
          </button>
        </div>
      </div>
    </div>
  }

  <!-- ========== CONTENIDO PRINCIPAL ========== -->
  <div class="pokemon-content">

    <!-- Columna izquierda: Imagen -->
    <div class="pokemon-content__left">
      <!-- Imagen principal -->
      <div class="pokemon-image">
        <img
          [src]="pokemon.image"
          [alt]="'Imagen oficial del Pokémon ' + pokemon.name"
          class="pokemon-image__img">
      </div>
    </div>

    <!-- Columna derecha: Información -->
    <div class="pokemon-content__right">

      <!-- Descripción -->
      <p class="pokemon-description">{{ pokemon.description }}</p>

      <!-- Card de información principal -->
      <div class="pokemon-info-card" role="region" aria-label="Información básica del Pokémon">
        <div class="pokemon-info-card__row">
          <div class="pokemon-info-card__item">
            <span class="pokemon-info-card__label">Altura</span>
            <span class="pokemon-info-card__value">{{ pokemon.height }} m</span>
          </div>
          <div class="pokemon-info-card__item">
            <span class="pokemon-info-card__label">Peso</span>
            <span class="pokemon-info-card__value">{{ pokemon.weight }} kg</span>
          </div>
        </div>
        <div class="pokemon-info-card__row">
          <div class="pokemon-info-card__item">
            <span class="pokemon-info-card__label">Categoría</span>
            <span class="pokemon-info-card__value">{{ pokemon.category }}</span>
          </div>
          <div class="pokemon-info-card__item">
            <span class="pokemon-info-card__label">Región de origen</span>
            <span class="pokemon-info-card__value">{{ pokemon.region }}</span>
          </div>
        </div>
        <div class="pokemon-info-card__row">
          <div class="pokemon-info-card__item">
            <span class="pokemon-info-card__label">Género</span>
            <span class="pokemon-info-card__value pokemon-info-card__value--gender">
              @if (pokemon.gender.male && pokemon.gender.female) {
                <span class="pokemon-info-card__gender pokemon-info-card__gender--male">♂</span>
                <span class="pokemon-info-card__gender pokemon-info-card__gender--female">♀</span>
              } @else if (pokemon.gender.male) {
                <span class="pokemon-info-card__gender pokemon-info-card__gender--male">♂</span>
              } @else if (pokemon.gender.female) {
                <span class="pokemon-info-card__gender pokemon-info-card__gender--female">♀</span>
              } @else {
                <span class="pokemon-info-card__gender pokemon-info-card__gender--none">No tiene género</span>
              }
            </span>
          </div>
        </div>
      </div>

      <!-- Tipo y Debilidades en una fila -->
      <div class="pokemon-type-weakness">
        <div class="pokemon-type-weakness__section">
          <h3 class="pokemon-type-weakness__title">Tipo</h3>
          <div class="pokemon-type-weakness__list">
            @for (type of pokemon.types; track type) {
              <span
                class="pokemon-type-weakness__badge"
                [style.background-color]="getTypeColor(type)">
                {{ getTypeName(type) }}
              </span>
            }
          </div>
        </div>
        <div class="pokemon-type-weakness__section">
          <h3 class="pokemon-type-weakness__title">Debilidad</h3>
          <div class="pokemon-type-weakness__list">
            @for (weakness of pokemon.weaknesses; track weakness) {
              <span
                class="pokemon-type-weakness__badge"
                [style.background-color]="getTypeColor(weakness)">
                {{ getTypeName(weakness) }}
              </span>
            }
          </div>
        </div>
      </div>

    </div>

  </div>

  <!-- ========== ESTADÍSTICAS BASE ========== -->
  <section class="pokemon-stats-section">
    <h2 class="pokemon-stats-section__title">Estadísticas base</h2>
    <div class="pokemon-stats">
      <div class="pokemon-stats__grid">

        <!-- PS -->
        <div class="pokemon-stats__row">
          <span class="pokemon-stats__label">PS</span>
          <div class="pokemon-stats__bar-container">
            <div
              class="pokemon-stats__bar pokemon-stats__bar--hp"
              [style.width.%]="getStatPercentage(pokemon.stats.hp)">
            </div>
          </div>
          <span class="pokemon-stats__value">{{ pokemon.stats.hp }}</span>
        </div>

        <!-- Ataque -->
        <div class="pokemon-stats__row">
          <span class="pokemon-stats__label">Ataque</span>
          <div class="pokemon-stats__bar-container">
            <div
              class="pokemon-stats__bar pokemon-stats__bar--attack"
              [style.width.%]="getStatPercentage(pokemon.stats.attack)">
            </div>
          </div>
          <span class="pokemon-stats__value">{{ pokemon.stats.attack }}</span>
        </div>

        <!-- Defensa -->
        <div class="pokemon-stats__row">
          <span class="pokemon-stats__label">Defensa</span>
          <div class="pokemon-stats__bar-container">
            <div
              class="pokemon-stats__bar pokemon-stats__bar--defense"
              [style.width.%]="getStatPercentage(pokemon.stats.defense)">
            </div>
          </div>
          <span class="pokemon-stats__value">{{ pokemon.stats.defense }}</span>
        </div>

        <!-- Ataque Especial -->
        <div class="pokemon-stats__row">
          <span class="pokemon-stats__label">At. Esp.</span>
          <div class="pokemon-stats__bar-container">
            <div
              class="pokemon-stats__bar pokemon-stats__bar--sp-attack"
              [style.width.%]="getStatPercentage(pokemon.stats.spAttack)">
            </div>
          </div>
          <span class="pokemon-stats__value">{{ pokemon.stats.spAttack }}</span>
        </div>

        <!-- Defensa Especial -->
        <div class="pokemon-stats__row">
          <span class="pokemon-stats__label">Def. Esp.</span>
          <div class="pokemon-stats__bar-container">
            <div
              class="pokemon-stats__bar pokemon-stats__bar--sp-defense"
              [style.width.%]="getStatPercentage(pokemon.stats.spDefense)">
            </div>
          </div>
          <span class="pokemon-stats__value">{{ pokemon.stats.spDefense }}</span>
        </div>

        <!-- Velocidad -->
        <div class="pokemon-stats__row">
          <span class="pokemon-stats__label">Velocidad</span>
          <div class="pokemon-stats__bar-container">
            <div
              class="pokemon-stats__bar pokemon-stats__bar--speed"
              [style.width.%]="getStatPercentage(pokemon.stats.speed)">
            </div>
          </div>
          <span class="pokemon-stats__value">{{ pokemon.stats.speed }}</span>
        </div>

      </div>
    </div>
  </section>

  <!-- ========== EVOLUCIONES ========== -->
  <section class="pokemon-evolutions">
    <h2 class="pokemon-evolutions__title">Evoluciones</h2>
    
    @if (pokemon.evolutions && pokemon.evolutions.length > 1) {
      
      <!-- ===== EVOLUCIONES RAMIFICADAS NIVEL 1 (Eevee, Tyrogue) ===== -->
      @if (pokemon.hasBranchedEvolutions && pokemon.branchLevel === 1) {
        <div class="pokemon-evolutions__branched" [class.pokemon-evolutions__branched--eevee]="pokemon.evolutions[0]?.id === 133">
          <!-- Pokémon base a la izquierda -->
          <div class="pokemon-evolutions__item" (click)="navigateToPokemon(pokemon.evolutions[0].id)">
            <div class="pokemon-evolutions__image-wrapper pokemon-evolutions__image-wrapper--large">
              <img
                [src]="pokemon.evolutions[0].image"
                [alt]="pokemon.evolutions[0].name"
                class="pokemon-evolutions__image">
            </div>
            <div class="pokemon-evolutions__info">
              <span class="pokemon-evolutions__name">{{ pokemon.evolutions[0].name }}</span>
              <span class="pokemon-evolutions__id">{{ formatPokemonId(pokemon.evolutions[0].id) }}</span>
            </div>
            <div class="pokemon-evolutions__types">
              @for (type of pokemon.evolutions[0].types; track type) {
                <span
                  class="pokemon-evolutions__type"
                  [style.background-color]="getTypeColor(type)">
                  {{ getTypeName(type) }}
                </span>
              }
            </div>
          </div>

          <!-- Columna de evoluciones a la derecha -->
          <div class="pokemon-evolutions__branches">
            @for (evo of pokemon.evolutions.slice(1); track evo.id) {
              <div class="pokemon-evolutions__branch-row">
                <!-- Método y flecha -->
                <div class="pokemon-evolutions__arrow pokemon-evolutions__arrow--horizontal">
                  @if (evo.evolutionMethod) {
                    <span class="pokemon-evolutions__method">{{ evo.evolutionMethod }}</span>
                  }
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M9 18l6-6-6-6"/>
                  </svg>
                </div>
                <!-- Pokémon evolucionado -->
                <div class="pokemon-evolutions__item" (click)="navigateToPokemon(evo.id)">
                  <div class="pokemon-evolutions__image-wrapper">
                    <img
                      [src]="evo.image"
                      [alt]="evo.name"
                      class="pokemon-evolutions__image">
                  </div>
                  <div class="pokemon-evolutions__info">
                    <span class="pokemon-evolutions__name">{{ evo.name }}</span>
                    <span class="pokemon-evolutions__id">{{ formatPokemonId(evo.id) }}</span>
                  </div>
                  <div class="pokemon-evolutions__types">
                    @for (type of evo.types; track type) {
                      <span
                        class="pokemon-evolutions__type"
                        [style.background-color]="getTypeColor(type)">
                        {{ getTypeName(type) }}
                      </span>
                    }
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- ===== EVOLUCIONES RAMIFICADAS NIVEL 2 (Oddish→Gloom→Vileplume/Bellossom) ===== -->
      @else if (pokemon.hasBranchedEvolutions && pokemon.branchLevel === 2 && pokemon.secondStageEvolution) {
        <div class="pokemon-evolutions__branched-level2">
          <!-- Pokémon base -->
          <div class="pokemon-evolutions__item" (click)="navigateToPokemon(pokemon.evolutions[0].id)">
            <div class="pokemon-evolutions__image-wrapper">
              <img
                [src]="pokemon.evolutions[0].image"
                [alt]="pokemon.evolutions[0].name"
                class="pokemon-evolutions__image">
            </div>
            <div class="pokemon-evolutions__info">
              <span class="pokemon-evolutions__name">{{ pokemon.evolutions[0].name }}</span>
              <span class="pokemon-evolutions__id">{{ formatPokemonId(pokemon.evolutions[0].id) }}</span>
            </div>
            <div class="pokemon-evolutions__types">
              @for (type of pokemon.evolutions[0].types; track type) {
                <span
                  class="pokemon-evolutions__type"
                  [style.background-color]="getTypeColor(type)">
                  {{ getTypeName(type) }}
                </span>
              }
            </div>
          </div>

          <!-- Flecha hacia etapa intermedia -->
          <div class="pokemon-evolutions__arrow pokemon-evolutions__arrow--horizontal">
            @if (pokemon.secondStageEvolution.evolutionMethod) {
              <span class="pokemon-evolutions__method">{{ pokemon.secondStageEvolution.evolutionMethod }}</span>
            }
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 18l6-6-6-6"/>
            </svg>
          </div>

          <!-- Pokémon etapa intermedia (Gloom) -->
          <div class="pokemon-evolutions__item" (click)="navigateToPokemon(pokemon.secondStageEvolution.id)">
            <div class="pokemon-evolutions__image-wrapper">
              <img
                [src]="pokemon.secondStageEvolution.image"
                [alt]="pokemon.secondStageEvolution.name"
                class="pokemon-evolutions__image">
            </div>
            <div class="pokemon-evolutions__info">
              <span class="pokemon-evolutions__name">{{ pokemon.secondStageEvolution.name }}</span>
              <span class="pokemon-evolutions__id">{{ formatPokemonId(pokemon.secondStageEvolution.id) }}</span>
            </div>
            <div class="pokemon-evolutions__types">
              @for (type of pokemon.secondStageEvolution.types; track type) {
                <span
                  class="pokemon-evolutions__type"
                  [style.background-color]="getTypeColor(type)">
                  {{ getTypeName(type) }}
                </span>
              }
            </div>
          </div>

          <!-- Columna de evoluciones finales -->
          <div class="pokemon-evolutions__branches">
            @for (evo of pokemon.evolutions.slice(1); track evo.id) {
              <div class="pokemon-evolutions__branch-row">
                <!-- Método y flecha -->
                <div class="pokemon-evolutions__arrow pokemon-evolutions__arrow--horizontal">
                  @if (evo.evolutionMethod) {
                    <span class="pokemon-evolutions__method">{{ evo.evolutionMethod }}</span>
                  }
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M9 18l6-6-6-6"/>
                  </svg>
                </div>
                <!-- Pokémon evolucionado -->
                <div class="pokemon-evolutions__item" (click)="navigateToPokemon(evo.id)">
                  <div class="pokemon-evolutions__image-wrapper">
                    <img
                      [src]="evo.image"
                      [alt]="evo.name"
                      class="pokemon-evolutions__image">
                  </div>
                  <div class="pokemon-evolutions__info">
                    <span class="pokemon-evolutions__name">{{ evo.name }}</span>
                    <span class="pokemon-evolutions__id">{{ formatPokemonId(evo.id) }}</span>
                  </div>
                  <div class="pokemon-evolutions__types">
                    @for (type of evo.types; track type) {
                      <span
                        class="pokemon-evolutions__type"
                        [style.background-color]="getTypeColor(type)">
                        {{ getTypeName(type) }}
                      </span>
                    }
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- ===== EVOLUCIONES LINEALES (Bulbasaur, Charmander, etc.) ===== -->
      @else {
        <div class="pokemon-evolutions__chain">
          @for (evo of pokemon.evolutions; track evo.id; let i = $index; let last = $last) {
            <div class="pokemon-evolutions__item" (click)="navigateToPokemon(evo.id)">
              <div class="pokemon-evolutions__image-wrapper">
                <img
                  [src]="evo.image"
                  [alt]="evo.name"
                  class="pokemon-evolutions__image">
              </div>
              <div class="pokemon-evolutions__info">
                <span class="pokemon-evolutions__name">{{ evo.name }}</span>
                <span class="pokemon-evolutions__id">{{ formatPokemonId(evo.id) }}</span>
              </div>
              <div class="pokemon-evolutions__types">
                @for (type of evo.types; track type) {
                  <span
                    class="pokemon-evolutions__type"
                    [style.background-color]="getTypeColor(type)">
                    {{ getTypeName(type) }}
                  </span>
                }
              </div>
            </div>
            @if (!last) {
              <div class="pokemon-evolutions__arrow pokemon-evolutions__arrow--horizontal">
                @if (pokemon.evolutions[i + 1]?.evolutionMethod) {
                  <span class="pokemon-evolutions__method">{{ pokemon.evolutions[i + 1].evolutionMethod }}</span>
                }
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18l6-6-6-6"/>
                </svg>
              </div>
            }
          }
        </div>
      }

    } @else {
      <p class="pokemon-evolutions__no-evolution">Este Pokémon no evoluciona</p>
    }
  </section>

  <!-- ========== BOTÓN VOLVER ========== -->
  <section class="pokemon-back" aria-label="Navegación">
    <button class="pokemon-back__btn" (click)="goBack()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
      @if (fromHome) {
        Regresar al inicio
      } @else {
        Volver a la Pokédex
      }
    </button>
  </section>

</main>