<div class="eventos-demo">
  <!-- ============================================================================ -->
  <!--                    HEADER                                                    -->
  <!-- ============================================================================ -->
  <header class="eventos-demo__header">
    <h1 class="eventos-demo__title">Demostración de Rúbricas 2.3 y 2.4</h1>
    <p class="eventos-demo__subtitle">
      Prevención de Eventos y @HostListener
    </p>
  </header>

  <!-- ============================================================================ -->
  <!--           SECCIÓN 1: preventDefault() EN FORMULARIO (RÚBRICA 2.3)           -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--success">2.3</span>
        1. preventDefault() en Formularios
      </h2>
      <p class="eventos-demo__description">
        Sin <code>event.preventDefault()</code>, el formulario recargaría la página.
        Con él, manejamos el envío con JavaScript sin perder el estado.
      </p>
    </div>

    <div class="eventos-demo__card">
      <form class="eventos-demo__form" (ngSubmit)="onFormSubmit($event)">
        <h3>Formulario de Contacto</h3>

        <div class="form-field">
          <label for="nombre">Nombre:</label>
          <input
            type="text"
            id="nombre"
            name="nombre"
            [(ngModel)]="formData.nombre"
            required
            class="form-input">
        </div>

        <div class="form-field">
          <label for="email">Email:</label>
          <input
            type="email"
            id="email"
            name="email"
            [(ngModel)]="formData.email"
            required
            class="form-input">
        </div>

        <div class="form-field">
          <label for="mensaje">Mensaje:</label>
          <textarea
            id="mensaje"
            name="mensaje"
            [(ngModel)]="formData.mensaje"
            rows="3"
            class="form-input"></textarea>
        </div>

        <button type="submit" class="btn btn--primary">
          Enviar Formulario (con preventDefault)
        </button>

        @if (formSubmitted) {
          <div class="alert alert--success">
            ✓ Formulario enviado {{ submitCount }} vez/veces sin recargar la página!
            <br>
            <small>Código: <code>event.preventDefault()</code> en línea 41</small>
          </div>
        }
      </form>

      <div class="eventos-demo__code">
        <h4>Código TypeScript:</h4>
        <pre><code>onFormSubmit(event: Event): void &#123;
  // PREVENCIÓN: Prevenir recarga de página
  event.preventDefault();

  this.formSubmitted = true;
  this.submitCount++;
  console.log('Formulario enviado:', this.formData);
&#125;</code></pre>

        <h4>Ubicación real:</h4>
        <ul>
          <li><code>src/app/pages/login/login.ts</code> línea 109</li>
          <li><code>src/app/pages/register/register.ts</code> línea 288</li>
          <li><code>src/app/pages/forms-demo/forms-demo.ts</code> líneas 173 y 319</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- ============================================================================ -->
  <!--      SECCIÓN 2: stopPropagation() EN MODAL (RÚBRICA 2.3)                    -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--success">2.3</span>
        2. stopPropagation() en Modal
      </h2>
      <p class="eventos-demo__description">
        Sin <code>event.stopPropagation()</code>, cualquier click dentro del modal lo cerraría.
        Con él, solo los clicks en el overlay oscuro cierran el modal.
      </p>
    </div>

    <div class="eventos-demo__card">
      <button class="btn btn--primary" (click)="openModal()">
        Abrir Modal (demostración stopPropagation)
      </button>

      <div class="eventos-demo__instructions">
        <h4>Instrucciones:</h4>
        <ol>
          <li>Haz click en "Abrir Modal"</li>
          <li>Haz click DENTRO del contenido del modal (caja blanca)</li>
          <li>✓ El modal NO se cierra (gracias a stopPropagation)</li>
          <li>Haz click FUERA del modal (área oscura)</li>
          <li>✓ El modal SÍ se cierra</li>
        </ol>

        @if (isModalOpen && modalClickCount > 0) {
          <div class="alert alert--info">
            Clicks dentro del modal: {{ modalClickCount }}
            <br>
            <small>El modal sigue abierto gracias a <code>stopPropagation()</code></small>
          </div>
        }
      </div>

      <div class="eventos-demo__code">
        <h4>Código TypeScript:</h4>
        <pre><code>onModalContentClick(event: MouseEvent): void &#123;
  // PREVENCIÓN: Detener propagación al overlay
  event.stopPropagation();
&#125;</code></pre>

        <h4>Ubicación real:</h4>
        <ul>
          <li><code>src/components/shared/modal/modal.ts</code> línea 74</li>
          <li><code>src/components/shared/modal/modal.html</code> línea 18</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Modal Component -->
  @if (isModalOpen) {
    <app-modal
      [isOpen]="isModalOpen"
      [title]="'Demostración de stopPropagation()'"
      [size]="'md'"
      (closed)="closeModal()">

      <div (click)="onModalInnerClick()" class="modal-demo-content">
        <p><strong>Haz click aquí dentro del modal</strong></p>
        <p>El modal NO se cerrará porque usamos <code>stopPropagation()</code></p>
        <p>Clicks registrados: <strong>{{ modalClickCount }}</strong></p>

        <button class="btn btn--secondary" (click)="onModalInnerClick()">
          Click aquí (no cierra el modal)
        </button>

        <div class="alert alert--info" style="margin-top: 1rem;">
          <strong>Prueba esto:</strong>
          <ol style="margin-left: 1.5rem;">
            <li>Haz varios clicks en este botón</li>
            <li>Nota que el contador aumenta</li>
            <li>El modal NO se cierra</li>
            <li>Ahora haz click en el área oscura de fuera</li>
            <li>El modal SÍ se cierra</li>
          </ol>
        </div>
      </div>

      <div modal-footer>
        <button class="btn btn--primary" (click)="closeModal()">
          Cerrar Modal
        </button>
      </div>
    </app-modal>
  }

  <!-- ============================================================================ -->
  <!--  SECCIÓN 3: @HostListener ESCAPE Y CLICK FUERA (RÚBRICA 2.4)                -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--warning">2.4</span>
        3. @HostListener('document:keydown.escape')
      </h2>
      <p class="eventos-demo__description">
        Los componentes escuchan eventos globales del documento/ventana usando @HostListener
      </p>
    </div>

    <div class="eventos-demo__card">
      <h3>Abrir el modal y presionar ESC</h3>
      <button class="btn btn--primary" (click)="openModal()">
        Abrir Modal
      </button>

      <div class="alert alert--info">
        <strong>Prueba esto:</strong>
        <ol>
          <li>Abre el modal</li>
          <li>Presiona la tecla <kbd>ESC</kbd></li>
          <li>✓ El modal se cierra automáticamente</li>
        </ol>
      </div>

      <div class="eventos-demo__code">
        <h4>Código TypeScript:</h4>
        <pre><code>@HostListener('document:keydown.escape')
onEscapeKey(): void &#123;
  if (this.isOpen && this.closeOnEsc) &#123;
    this.close();
  &#125;
&#125;</code></pre>

        <h4>Ubicación real:</h4>
        <ul>
          <li><code>src/components/shared/modal/modal.ts</code> línea 85</li>
          <li><code>src/components/layout/header/header.ts</code> línea 187</li>
          <li><code>src/components/shared/custom-select/custom-select.ts</code> línea 92</li>
          <li><code>src/components/shared/tooltip/tooltip.ts</code> línea 130</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- ============================================================================ -->
  <!--  SECCIÓN 4: @HostListener CLICK FUERA (RÚBRICA 2.4)                         -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--warning">2.4</span>
        4. @HostListener('document:click')
      </h2>
      <p class="eventos-demo__description">
        Los dropdowns se cierran al hacer click fuera de ellos
      </p>
    </div>

    <div class="eventos-demo__card">
      <h3>Custom Select con "Click Fuera"</h3>

      <div class="form-field">
        <label>Selecciona un país:</label>
        <app-custom-select
          [selectId]="'country'"
          [options]="countries"
          [(ngModel)]="selectedCountry"
          [placeholder]="'Selecciona un país'">
        </app-custom-select>
      </div>

      @if (selectedCountry) {
        <div class="alert alert--success">
          País seleccionado: <strong>{{ selectedCountry }}</strong>
        </div>
      }

      <div class="alert alert--info">
        <strong>Prueba esto:</strong>
        <ol>
          <li>Haz click en el select para abrirlo</li>
          <li>SIN seleccionar nada, haz click fuera del dropdown</li>
          <li>✓ El dropdown se cierra automáticamente</li>
          <li>Esto funciona gracias a @HostListener('document:click')</li>
        </ol>
      </div>

      <div class="eventos-demo__code">
        <h4>Código TypeScript:</h4>
        <pre><code>@HostListener('document:click', ['$event'])
onDocumentClick(event: MouseEvent): void &#123;
  if (!this.elementRef.nativeElement.contains(event.target)) &#123;
    this.isOpen = false;
  &#125;
&#125;</code></pre>

        <h4>Ubicación real:</h4>
        <ul>
          <li><code>src/components/shared/custom-select/custom-select.ts</code> línea 84</li>
          <li><code>src/components/layout/header/header.ts</code> línea 197</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- ============================================================================ -->
  <!--  SECCIÓN 5: @HostListener WINDOW RESIZE (RÚBRICA 2.4)                       -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--warning">2.4</span>
        5. @HostListener('window:resize')
      </h2>
      <p class="eventos-demo__description">
        Los componentes se ajustan automáticamente al cambiar el tamaño de ventana
      </p>
    </div>

    <div class="eventos-demo__card">
      <div class="alert alert--info">
        <strong>Prueba esto:</strong>
        <ol>
          <li>Abre el modal</li>
          <li>Usa las DevTools para simular un dispositivo móvil</li>
          <li>O redimensiona la ventana del navegador</li>
          <li>✓ El modal se ajusta automáticamente</li>
          <li>Abre el dropdown del select</li>
          <li>Redimensiona la ventana</li>
          <li>✓ El dropdown se reposiciona si es necesario</li>
        </ol>
      </div>

      <div class="eventos-demo__code">
        <h4>Código TypeScript:</h4>
        <pre><code>@HostListener('window:resize')
onWindowResize(): void &#123;
  if (!this.isOpen) return;

  // Recalcular posición del componente
  const rect = this.elementRef.nativeElement.getBoundingClientRect();
  const spaceBelow = window.innerHeight - rect.bottom;

  this.repositionComponent(spaceBelow);
&#125;</code></pre>

        <h4>Ubicación real:</h4>
        <ul>
          <li><code>src/components/shared/modal/modal.ts</code> línea 153</li>
          <li><code>src/components/shared/custom-select/custom-select.ts</code> línea 102</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- ============================================================================ -->
  <!--  SECCIÓN 6: ACCORDION CON NAVEGACIÓN POR TECLADO (RÚBRICA 2.3 + 2.4)        -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--success">2.3</span>
        <span class="badge badge--warning">2.4</span>
        6. Accordion: preventDefault() + stopPropagation()
      </h2>
      <p class="eventos-demo__description">
        Navegación con teclado usando múltiples técnicas de prevención de eventos
      </p>
    </div>

    <div class="eventos-demo__card">
      <h3>Accordion con Navegación por Teclado</h3>

      <app-accordion
        [items]="accordionItems"
        [multiple]="false"
        [variant]="'bordered'">
      </app-accordion>

      <div class="alert alert--info">
        <strong>Prueba esto:</strong>
        <ol>
          <li>Haz click en un ítem del accordion para enfocarlo</li>
          <li>Usa <kbd>↑</kbd> y <kbd>↓</kbd> para navegar</li>
          <li>✓ El foco se mueve pero la página NO hace scroll</li>
          <li>Usa <kbd>Home</kbd> y <kbd>End</kbd></li>
          <li>✓ Va al primer/último ítem sin scroll de página</li>
          <li>Usa <kbd>Enter</kbd> o <kbd>Espacio</kbd> para abrir/cerrar</li>
          <li>✓ Funciona sin comportamiento por defecto del navegador</li>
        </ol>
      </div>

      <div class="eventos-demo__code">
        <h4>Código TypeScript:</h4>
        <pre><code>onKeyDown(event: KeyboardEvent): void &#123;
  switch (event.key) &#123;
    case 'ArrowUp':
      event.preventDefault();      // Evita scroll
      event.stopPropagation();     // Evita propagación
      this.moveFocusUp();
      break;
    case 'ArrowDown':
      event.preventDefault();
      event.stopPropagation();
      this.moveFocusDown();
      break;
    // ... Home, End, Enter, Space
  &#125;
&#125;</code></pre>

        <h4>Ubicación real:</h4>
        <ul>
          <li><code>src/components/shared/accordion/accordion.ts</code> líneas 107-153</li>
          <li>5 teclas con preventDefault() + stopPropagation()</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- ============================================================================ -->
  <!--  SECCIÓN 7: MÁS CONTEXTOS DE preventDefault() (RÚBRICA 2.3)                 -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--success">2.3</span>
        7. Más Contextos de preventDefault()
      </h2>
      <p class="eventos-demo__description">
        Implementaciones adicionales en Custom Select (drag del scrollbar)
      </p>
    </div>

    <div class="eventos-demo__card">
      <h3>Custom Select - Scrollbar Personalizado</h3>

      <div class="eventos-demo__instructions">
        <h4>Contexto 1: Mouse Drag (preventDefault + stopPropagation)</h4>
        <p>Cuando arrastras la barra de scroll con el mouse en un custom select:</p>
        <ol>
          <li><code>preventDefault()</code> evita que se seleccione texto mientras arrastras</li>
          <li><code>stopPropagation()</code> evita que el click cierre el dropdown</li>
        </ol>

        <h4 style="margin-top: 1.5rem;">Contexto 2: Touch Drag (preventDefault + stopPropagation)</h4>
        <p>Lo mismo pero para dispositivos táctiles:</p>
        <ol>
          <li><code>preventDefault()</code> evita el comportamiento por defecto del touch</li>
          <li><code>stopPropagation()</code> evita que el touch cierre el dropdown</li>
        </ol>
      </div>

      <div class="eventos-demo__code">
        <h4>Código TypeScript (Mouse):</h4>
        <pre><code>onScrollbarMouseDown(event: MouseEvent): void &#123;
  // PREVENCIÓN: Evitar selección de texto durante el drag
  event.preventDefault();
  // CONTROL DE PROPAGACIÓN: Evitar que el click cierre el dropdown
  event.stopPropagation();
  this.startDrag(event.clientY);
&#125;</code></pre>

        <h4>Código TypeScript (Touch):</h4>
        <pre><code>onScrollbarTouchStart(event: TouchEvent): void &#123;
  // PREVENCIÓN: Evitar comportamiento por defecto del touch
  event.preventDefault();
  // CONTROL DE PROPAGACIÓN: Evitar que el touch cierre el dropdown
  event.stopPropagation();
  const touch = event.touches[0];
  this.startDrag(touch.clientY);
&#125;</code></pre>

        <h4>Ubicación real:</h4>
        <ul>
          <li><code>src/components/shared/custom-select/custom-select.ts</code> líneas 171-176 (mouse)</li>
          <li><code>src/components/shared/custom-select/custom-select.ts</code> líneas 187-193 (touch)</li>
        </ul>

        <h4>Cómo probarlo:</h4>
        <p>Ve a <code>/register</code>, paso 2, abre cualquier select y arrastra la barra de scroll personalizada</p>
      </div>
    </div>
  </section>

  <!-- ============================================================================ -->
  <!--  SECCIÓN 8: MÁS @HostListener (RÚBRICA 2.4)                                 -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--warning">2.4</span>
        8. Eventos Adicionales con @HostListener
      </h2>
      <p class="eventos-demo__description">
        Implementaciones extra: document:wheel, document:keydown (Tab), eventos de mouse y focus
      </p>
    </div>

    <div class="eventos-demo__card">
      <h3>Modal - Prevenir Scroll del Body</h3>

      <div class="eventos-demo__instructions">
        <h4>@HostListener('document:wheel')</h4>
        <p>Cuando el modal está abierto, previene que el scroll de la rueda del mouse afecte al contenido de fondo:</p>
      </div>

      <div class="eventos-demo__code">
        <pre><code>@HostListener('document:wheel', ['$event'])
onDocumentWheel(event: WheelEvent): void &#123;
  if (this.isOpen && this.blockScroll) &#123;
    const target = event.target as HTMLElement;
    const modalElement = target.closest('.modal');

    if (!modalElement) &#123;
      event.preventDefault();
    &#125;
  &#125;
&#125;</code></pre>

        <h4>Ubicación real:</h4>
        <ul>
          <li><code>src/components/shared/modal/modal.ts</code> líneas 96-108</li>
        </ul>
      </div>
    </div>

    <div class="eventos-demo__card">
      <h3>Modal - Trap Focus (mantener foco dentro)</h3>

      <div class="eventos-demo__instructions">
        <h4>@HostListener('document:keydown', ['$event']) - Tab Key</h4>
        <p>Cuando el modal está abierto, la tecla Tab mantiene el foco dentro del modal (no escapa):</p>
      </div>

      <div class="eventos-demo__code">
        <pre><code>@HostListener('document:keydown', ['$event'])
onTabKey(event: KeyboardEvent): void &#123;
  if (!this.isOpen || event.key !== 'Tab') return;

  // Obtener elementos enfocables dentro del modal
  const focusableElements = this.getFocusableElements();
  const firstElement = focusableElements[0];
  const lastElement = focusableElements[focusableElements.length - 1];

  // Lógica de trap focus...
&#125;</code></pre>

        <h4>Ubicación real:</h4>
        <ul>
          <li><code>src/components/shared/modal/modal.ts</code> líneas 114-146</li>
        </ul>
      </div>
    </div>

    <div class="eventos-demo__card">
      <h3>Tooltip - Eventos de Interacción</h3>

      <div class="eventos-demo__instructions">
        <h4>4 eventos de mouse y focus:</h4>
        <ol>
          <li><code>@HostListener('mouseenter')</code> - Mostrar tooltip al pasar el mouse</li>
          <li><code>@HostListener('mouseleave')</code> - Ocultar tooltip al salir</li>
          <li><code>@HostListener('focusin')</code> - Mostrar tooltip al enfocar con teclado</li>
          <li><code>@HostListener('focusout')</code> - Ocultar tooltip al desenfocar</li>
        </ol>
      </div>

      <div class="eventos-demo__code">
        <pre><code>@HostListener('mouseenter')
onMouseEnter(): void &#123; this.scheduleShow(); &#125;

@HostListener('mouseleave')
onMouseLeave(): void &#123; this.scheduleHide(); &#125;

@HostListener('focusin')
onFocusIn(): void &#123; this.scheduleShow(); &#125;

@HostListener('focusout')
onFocusOut(): void &#123; this.scheduleHide(); &#125;</code></pre>

        <h4>Ubicación real:</h4>
        <ul>
          <li><code>src/components/shared/tooltip/tooltip.ts</code> líneas 98-125</li>
        </ul>

        <h4>Cómo probarlo:</h4>
        <p>Ve a <code>/style-guide</code>, sección Tooltip, pasa el mouse sobre los elementos con tooltips</p>
      </div>
    </div>
  </section>

  <!-- ============================================================================ -->
  <!--                    RESUMEN FINAL                                             -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        Resumen de Implementaciones
      </h2>
    </div>

    <div class="eventos-demo__card">
      <h3>Rúbrica 2.3: Prevención y Control de Propagación (10/10)</h3>
      <p><strong>preventDefault() en 4 formularios:</strong></p>
      <ol>
        <li>Login page - <code>login.ts:109</code></li>
        <li>Register page - <code>register.ts:288</code></li>
        <li>Forms-demo (formulario registro) - <code>forms-demo.ts:173</code></li>
        <li>Forms-demo (formulario factura) - <code>forms-demo.ts:319</code></li>
      </ol>

      <p><strong>stopPropagation() en modal:</strong></p>
      <ol start="5">
        <li>Modal component - <code>modal.ts:74</code></li>
      </ol>

      <p><strong>preventDefault() + stopPropagation() en custom-select:</strong></p>
      <ol start="6">
        <li>Scrollbar mousedown - <code>custom-select.ts:171-176</code></li>
        <li>Scrollbar touchstart - <code>custom-select.ts:187-193</code></li>
      </ol>

      <p><strong>preventDefault() + stopPropagation() en accordion (5 teclas):</strong></p>
      <ol start="8">
        <li>ArrowUp - <code>accordion.ts:116-121</code></li>
        <li>ArrowDown - <code>accordion.ts:124-128</code></li>
        <li>Home - <code>accordion.ts:131-135</code></li>
        <li>End - <code>accordion.ts:138-142</code></li>
        <li>Enter/Space - <code>accordion.ts:145-152</code></li>
      </ol>

      <p><strong>TOTAL RÚBRICA 2.3: 12 contextos diferentes ✓</strong></p>

      <hr style="margin: 2rem 0; border: none; border-top: 2px solid #e0e0e0;">

      <h3>Rúbrica 2.4: Eventos Globales con @HostListener (10/10)</h3>

      <p><strong>document:click (2 componentes):</strong></p>
      <ol>
        <li>Header - <code>header.ts:197</code></li>
        <li>Custom-select - <code>custom-select.ts:84</code></li>
      </ol>

      <p><strong>document:keydown.escape (4 componentes):</strong></p>
      <ol start="3">
        <li>Modal - <code>modal.ts:85</code></li>
        <li>Header - <code>header.ts:187</code></li>
        <li>Custom-select - <code>custom-select.ts:92</code></li>
        <li>Tooltip - <code>tooltip.ts:130</code></li>
      </ol>

      <p><strong>window:resize (2 componentes):</strong></p>
      <ol start="7">
        <li>Modal - <code>modal.ts:153</code></li>
        <li>Custom-select - <code>custom-select.ts:102</code></li>
      </ol>

      <p><strong>Eventos adicionales:</strong></p>
      <ol start="9">
        <li>Modal - <code>document:wheel</code> - <code>modal.ts:96</code></li>
        <li>Modal - <code>document:keydown</code> (Tab trap) - <code>modal.ts:114</code></li>
        <li>Tooltip - <code>mouseenter</code> - <code>tooltip.ts:98</code></li>
        <li>Tooltip - <code>mouseleave</code> - <code>tooltip.ts:106</code></li>
        <li>Tooltip - <code>focusin</code> - <code>tooltip.ts:114</code></li>
        <li>Tooltip - <code>focusout</code> - <code>tooltip.ts:122</code></li>
      </ol>

      <p><strong>TOTAL RÚBRICA 2.4: 14 @HostListener en 4+ componentes ✓</strong></p>

      <div class="alert alert--success" style="margin-top: 2rem;">
        <strong>✓ Todas las implementaciones están funcionando correctamente</strong>
        <br>
        <small>Documentado en: <code>frontend/RUBRICA_2.3_2.4_IMPLEMENTACION.md</code></small>
        <br>
        <small>Documentado en: <code>frontend/README Entorno cliente.md</code></small>
      </div>
    </div>
  </section>
</div>
