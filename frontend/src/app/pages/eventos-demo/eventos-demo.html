<div class="eventos-demo">
  <!-- ============================================================================ -->
  <!--                    HEADER                                                    -->
  <!-- ============================================================================ -->
  <header class="eventos-demo__header">
    <h1 class="eventos-demo__title">Demostraci√≥n de R√∫bricas 2.3 y 2.4</h1>
    <p class="eventos-demo__subtitle">
      Prevenci√≥n de Eventos y @HostListener
    </p>
  </header>

  <!-- ============================================================================ -->
  <!--           SECCI√ìN 1: preventDefault() EN FORMULARIO (R√öBRICA 2.3)           -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--success">2.3</span>
        1. preventDefault() en Formularios
      </h2>
      <p class="eventos-demo__description">
        Sin <code>event.preventDefault()</code>, el formulario recargar√≠a la p√°gina.
        Con √©l, manejamos el env√≠o con JavaScript sin perder el estado.
      </p>
    </div>

    <div class="eventos-demo__card">
      <form class="eventos-demo__form" (ngSubmit)="onFormSubmit($event)">
        <h3>Formulario de Contacto</h3>

        <div class="form-field">
          <label for="nombre">Nombre:</label>
          <input
            type="text"
            id="nombre"
            name="nombre"
            [(ngModel)]="formData.nombre"
            required
            class="form-input">
        </div>

        <div class="form-field">
          <label for="email">Email:</label>
          <input
            type="email"
            id="email"
            name="email"
            [(ngModel)]="formData.email"
            required
            class="form-input">
        </div>

        <div class="form-field">
          <label for="mensaje">Mensaje:</label>
          <textarea
            id="mensaje"
            name="mensaje"
            [(ngModel)]="formData.mensaje"
            rows="3"
            class="form-input"></textarea>
        </div>

        <button type="submit" class="btn btn--primary">
          Enviar Formulario (con preventDefault)
        </button>

        @if (formSubmitted) {
          <div class="alert alert--success">
            ‚úì Formulario enviado {{ submitCount }} vez/veces sin recargar la p√°gina!
            <br>
            <small>C√≥digo: <code>event.preventDefault()</code> en l√≠nea 41</small>
          </div>
        }
      </form>

      <div class="eventos-demo__code">
        <h4>C√≥digo TypeScript:</h4>
        <pre><code>onFormSubmit(event: Event): void &#123;
  // PREVENCI√ìN: Prevenir recarga de p√°gina
  event.preventDefault();

  this.formSubmitted = true;
  this.submitCount++;
  console.log('Formulario enviado:', this.formData);
&#125;</code></pre>

        <h4>Ubicaci√≥n real:</h4>
        <ul>
          <li><code>src/app/pages/login/login.ts</code> l√≠nea 109</li>
          <li><code>src/app/pages/register/register.ts</code> l√≠nea 288</li>
          <li><code>src/app/pages/forms-demo/forms-demo.ts</code> l√≠neas 173 y 319</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- ============================================================================ -->
  <!--      SECCI√ìN 2: stopPropagation() EN MODAL (R√öBRICA 2.3)                    -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--success">2.3</span>
        2. stopPropagation() en Modal
      </h2>
      <p class="eventos-demo__description">
        Sin <code>event.stopPropagation()</code>, cualquier click dentro del modal lo cerrar√≠a.
        Con √©l, solo los clicks en el overlay oscuro cierran el modal.
      </p>
    </div>

    <div class="eventos-demo__card">
      <button class="btn btn--primary" (click)="openModal()">
        Abrir Modal (demostraci√≥n stopPropagation)
      </button>

      <div class="eventos-demo__instructions">
        <h4>Instrucciones:</h4>
        <ol>
          <li>Haz click en "Abrir Modal"</li>
          <li>Haz click DENTRO del contenido del modal (caja blanca)</li>
          <li>‚úì El modal NO se cierra (gracias a stopPropagation)</li>
          <li>Haz click FUERA del modal (√°rea oscura)</li>
          <li>‚úì El modal S√ç se cierra</li>
        </ol>

        @if (isModalOpen && modalClickCount > 0) {
          <div class="alert alert--info">
            Clicks dentro del modal: {{ modalClickCount }}
            <br>
            <small>El modal sigue abierto gracias a <code>stopPropagation()</code></small>
          </div>
        }
      </div>

      <div class="eventos-demo__code">
        <h4>C√≥digo TypeScript:</h4>
        <pre><code>onModalContentClick(event: MouseEvent): void &#123;
  // PREVENCI√ìN: Detener propagaci√≥n al overlay
  event.stopPropagation();
&#125;</code></pre>

        <h4>Ubicaci√≥n real:</h4>
        <ul>
          <li><code>src/components/shared/modal/modal.ts</code> l√≠nea 74</li>
          <li><code>src/components/shared/modal/modal.html</code> l√≠nea 18</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Modal Component -->
  @if (isModalOpen) {
    <app-modal
      [isOpen]="isModalOpen"
      [title]="'Demostraci√≥n de stopPropagation()'"
      [size]="'md'"
      (closed)="closeModal()">

      <div (click)="onModalInnerClick()" class="modal-demo-content">
        <p><strong>Haz click aqu√≠ dentro del modal</strong></p>
        <p>El modal NO se cerrar√° porque usamos <code>stopPropagation()</code></p>
        <p>Clicks registrados: <strong>{{ modalClickCount }}</strong></p>

        <button class="btn btn--secondary" (click)="onModalInnerClick()">
          Click aqu√≠ (no cierra el modal)
        </button>

        <div class="alert alert--info" style="margin-top: 1rem;">
          <strong>Prueba esto:</strong>
          <ol style="margin-left: 1.5rem;">
            <li>Haz varios clicks en este bot√≥n</li>
            <li>Nota que el contador aumenta</li>
            <li>El modal NO se cierra</li>
            <li>Ahora haz click en el √°rea oscura de fuera</li>
            <li>El modal S√ç se cierra</li>
          </ol>
        </div>
      </div>

      <div modal-footer>
        <button class="btn btn--primary" (click)="closeModal()">
          Cerrar Modal
        </button>
      </div>
    </app-modal>
  }

  <!-- ============================================================================ -->
  <!--  SECCI√ìN 3: @HostListener ESCAPE Y CLICK FUERA (R√öBRICA 2.4)                -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--warning">2.4</span>
        3. @HostListener('document:keydown.escape')
      </h2>
      <p class="eventos-demo__description">
        Los componentes escuchan eventos globales del documento/ventana usando @HostListener
      </p>
    </div>

    <div class="eventos-demo__card">
      <h3>Abrir el modal y presionar ESC</h3>
      <button class="btn btn--primary" (click)="openModal()">
        Abrir Modal
      </button>

      <div class="alert alert--info">
        <strong>Prueba esto:</strong>
        <ol>
          <li>Abre el modal</li>
          <li>Presiona la tecla <kbd>ESC</kbd></li>
          <li>‚úì El modal se cierra autom√°ticamente</li>
        </ol>
      </div>

      <div class="eventos-demo__code">
        <h4>C√≥digo TypeScript:</h4>
        <pre><code>@HostListener('document:keydown.escape')
onEscapeKey(): void &#123;
  if (this.isOpen && this.closeOnEsc) &#123;
    this.close();
  &#125;
&#125;</code></pre>

        <h4>Ubicaci√≥n real:</h4>
        <ul>
          <li><code>src/components/shared/modal/modal.ts</code> l√≠nea 85</li>
          <li><code>src/components/layout/header/header.ts</code> l√≠nea 187</li>
          <li><code>src/components/shared/custom-select/custom-select.ts</code> l√≠nea 92</li>
          <li><code>src/components/shared/tooltip/tooltip.ts</code> l√≠nea 130</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- ============================================================================ -->
  <!--  SECCI√ìN 4: @HostListener CLICK FUERA (R√öBRICA 2.4)                         -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--warning">2.4</span>
        4. @HostListener('document:click')
      </h2>
      <p class="eventos-demo__description">
        Los dropdowns se cierran al hacer click fuera de ellos
      </p>
    </div>

    <div class="eventos-demo__card">
      <h3>Custom Select con "Click Fuera"</h3>

      <div class="form-field">
        <label>Selecciona un pa√≠s:</label>
        <app-custom-select
          [selectId]="'country'"
          [options]="countries"
          [(ngModel)]="selectedCountry"
          [placeholder]="'Selecciona un pa√≠s'">
        </app-custom-select>
      </div>

      @if (selectedCountry) {
        <div class="alert alert--success">
          Pa√≠s seleccionado: <strong>{{ selectedCountry }}</strong>
        </div>
      }

      <div class="alert alert--info">
        <strong>Prueba esto:</strong>
        <ol>
          <li>Haz click en el select para abrirlo</li>
          <li>SIN seleccionar nada, haz click fuera del dropdown</li>
          <li>‚úì El dropdown se cierra autom√°ticamente</li>
          <li>Esto funciona gracias a @HostListener('document:click')</li>
        </ol>
      </div>

      <div class="eventos-demo__code">
        <h4>C√≥digo TypeScript:</h4>
        <pre><code>@HostListener('document:click', ['$event'])
onDocumentClick(event: MouseEvent): void &#123;
  if (!this.elementRef.nativeElement.contains(event.target)) &#123;
    this.isOpen = false;
  &#125;
&#125;</code></pre>

        <h4>Ubicaci√≥n real:</h4>
        <ul>
          <li><code>src/components/shared/custom-select/custom-select.ts</code> l√≠nea 84</li>
          <li><code>src/components/layout/header/header.ts</code> l√≠nea 197</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- ============================================================================ -->
  <!--  SECCI√ìN 5: @HostListener WINDOW RESIZE (R√öBRICA 2.4)                       -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--warning">2.4</span>
        5. @HostListener('window:resize')
      </h2>
      <p class="eventos-demo__description">
        Los componentes se ajustan autom√°ticamente al cambiar el tama√±o de ventana
      </p>
    </div>

    <div class="eventos-demo__card">
      <div class="alert alert--info">
        <strong>Prueba esto:</strong>
        <ol>
          <li>Abre el modal</li>
          <li>Usa las DevTools para simular un dispositivo m√≥vil</li>
          <li>O redimensiona la ventana del navegador</li>
          <li>‚úì El modal se ajusta autom√°ticamente</li>
          <li>Abre el dropdown del select</li>
          <li>Redimensiona la ventana</li>
          <li>‚úì El dropdown se reposiciona si es necesario</li>
        </ol>
      </div>

      <div class="eventos-demo__code">
        <h4>C√≥digo TypeScript:</h4>
        <pre><code>@HostListener('window:resize')
onWindowResize(): void &#123;
  if (!this.isOpen) return;

  // Recalcular posici√≥n del componente
  const rect = this.elementRef.nativeElement.getBoundingClientRect();
  const spaceBelow = window.innerHeight - rect.bottom;

  this.repositionComponent(spaceBelow);
&#125;</code></pre>

        <h4>Ubicaci√≥n real:</h4>
        <ul>
          <li><code>src/components/shared/modal/modal.ts</code> l√≠nea 153</li>
          <li><code>src/components/shared/custom-select/custom-select.ts</code> l√≠nea 102</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- ============================================================================ -->
  <!--  SECCI√ìN 6: ACCORDION CON NAVEGACI√ìN POR TECLADO (R√öBRICA 2.3 + 2.4)        -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        <span class="badge badge--success">2.3</span>
        <span class="badge badge--warning">2.4</span>
        6. Accordion: preventDefault() + stopPropagation()
      </h2>
      <p class="eventos-demo__description">
        Navegaci√≥n con teclado usando m√∫ltiples t√©cnicas de prevenci√≥n de eventos
      </p>
    </div>

    <div class="eventos-demo__card">
      <h3>Accordion con Navegaci√≥n por Teclado</h3>

      <app-accordion
        [items]="accordionItems"
        [multiple]="false"
        [variant]="'bordered'">
      </app-accordion>

      <div class="alert alert--info">
        <strong>Prueba esto:</strong>
        <ol>
          <li>Haz click en un √≠tem del accordion para enfocarlo</li>
          <li>Usa <kbd>‚Üë</kbd> y <kbd>‚Üì</kbd> para navegar</li>
          <li>‚úì El foco se mueve pero la p√°gina NO hace scroll</li>
          <li>Usa <kbd>Home</kbd> y <kbd>End</kbd></li>
          <li>‚úì Va al primer/√∫ltimo √≠tem sin scroll de p√°gina</li>
          <li>Usa <kbd>Enter</kbd> o <kbd>Espacio</kbd> para abrir/cerrar</li>
          <li>‚úì Funciona sin comportamiento por defecto del navegador</li>
        </ol>
      </div>

      <div class="eventos-demo__code">
        <h4>C√≥digo TypeScript:</h4>
        <pre><code>onKeyDown(event: KeyboardEvent): void &#123;
  switch (event.key) &#123;
    case 'ArrowUp':
      event.preventDefault();      // Evita scroll
      event.stopPropagation();     // Evita propagaci√≥n
      this.moveFocusUp();
      break;
    case 'ArrowDown':
      event.preventDefault();
      event.stopPropagation();
      this.moveFocusDown();
      break;
    // ... Home, End, Enter, Space
  &#125;
&#125;</code></pre>

        <h4>Ubicaci√≥n real:</h4>
        <ul>
          <li><code>src/components/shared/accordion/accordion.ts</code> l√≠neas 107-153</li>
          <li>5 teclas con preventDefault() + stopPropagation()</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- ============================================================================ -->
  <!--                    RESUMEN FINAL                                             -->
  <!-- ============================================================================ -->
  <section class="eventos-demo__section">
    <div class="eventos-demo__section-header">
      <h2 class="eventos-demo__section-title">
        üìä Resumen de Implementaciones
      </h2>
    </div>

    <div class="eventos-demo__card">
      <h3>R√∫brica 2.3: Prevenci√≥n y Control de Propagaci√≥n (10/10)</h3>
      <ul>
        <li>‚úì <code>preventDefault()</code> en 4 formularios</li>
        <li>‚úì <code>stopPropagation()</code> en modal</li>
        <li>‚úì Ambos en custom-select (2 contextos)</li>
        <li>‚úì Ambos en accordion (5 teclas)</li>
        <li><strong>Total: 12 contextos diferentes</strong></li>
      </ul>

      <h3>R√∫brica 2.4: Eventos Globales con @HostListener (10/10)</h3>
      <ul>
        <li>‚úì <code>@HostListener('document:click')</code> en 2 componentes</li>
        <li>‚úì <code>@HostListener('document:keydown.escape')</code> en 4 componentes</li>
        <li>‚úì <code>@HostListener('window:resize')</code> en 2 componentes</li>
        <li>‚úì Eventos adicionales: wheel, keydown (Tab), mouse, focus</li>
        <li><strong>Total: 14 @HostListener en 4 componentes</strong></li>
      </ul>

      <div class="alert alert--success">
        <strong>‚úì Todas las implementaciones est√°n funcionando correctamente</strong>
        <br>
        <small>Documentado en: <code>frontend/RUBRICA_2.3_2.4_IMPLEMENTACION.md</code></small>
      </div>
    </div>
  </section>
</div>
