// ============================================================================
//                     HEADER COMPONENT - Estilos BEM
// ============================================================================
// Bloque: .header
// Elementos: __container, __logo, __nav, __actions, etc.
// Modificadores: --open, --active, --scrolled

@use '../../../styles/00-settings/variables' as *;
@use '../../../styles/01-tools/mixins' as *;

// ============================================================================
//                       BLOQUE PRINCIPAL: .header
// ============================================================================
.header {
  position: sticky;
  top: 0;
  z-index: $z-index-sticky;
  width: 100%;
  background: var(--bg-secondary, #{map-get($light-theme, bg-secondary)});
  border-bottom: 1px solid var(--border-secondary, #{map-get($light-theme, border-secondary)});
  
  // ============================================================================
  //                        ELEMENTO: __container
  // ============================================================================
  &__container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: $container-max-width;
    margin: 0 auto;
    padding: $spacing-3 $spacing-3;

    @include respond-to('sm') {
      padding: $spacing-4 $spacing-6;
    }

    @include respond-to('lg') {
      padding: $spacing-4 $spacing-8;
    }
  }
  
  // ============================================================================
  //                            ELEMENTO: __logo
  // ============================================================================
  &__logo {
    display: flex;
    align-items: center;
    gap: $spacing-2;
    text-decoration: none;
    color: var(--text-primary, #{map-get($dark-theme, text-primary)});
    transition: opacity 0.2s ease, transform 0.2s ease;
    flex-shrink: 0;
    outline: none;

    &:focus,
    &:focus-visible {
      outline: none;
    }

    @include respond-to('sm') {
      gap: $spacing-3;
    }

    :host-context(.light-theme) & {
      color: var(--text-primary, #{map-get($light-theme, text-primary)});
    }

    @include hover {
      opacity: 0.8;
      transform: scale(1.02);
    }
  }
  
 &__logo-icon {
  width: 40px;
  height: 40px;
  object-fit: contain;
  border-radius: 50%;

  @include respond-to('md') {
    width: 48px;
    height: 48px;
  }
}
  
  &__logo-text {
    font-family: $font-secondary;
    font-size: $font-size-lg;
    font-weight: $font-weight-bold;
    color: var(--text-primary, #{map-get($light-theme, text-primary)});
    white-space: nowrap;

    @include respond-to('sm') {
      font-size: $font-size-xl;
    }

    @include respond-to('md') {
      font-size: $font-size-2xl;
    }
  }
  
  // ============================================================================
  //                     ELEMENTO: __nav (Navegación)
  // ============================================================================
  &__nav {
    // Móvil: menú oculto por defecto
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--bg-secondary, #{map-get($light-theme, bg-secondary)});
    border-bottom: 1px solid var(--border-primary, #{map-get($light-theme, border-primary)});
    padding: $spacing-4;

    // MODIFICADOR: --open (menú abierto en móvil)
    &--open {
      display: block;
      animation: slideDown 0.3s ease-out;
    }

    // Desktop: siempre visible
    @include respond-to('md') {
      display: block;
      position: static;
      background: transparent;
      border: none;
      padding: 0;
    }
  }
  
  &__nav-list {
    display: flex;
    flex-direction: column;
    gap: $spacing-2;
    list-style: none;
    margin: 0;
    padding: 0;
    
    @include respond-to('md') {
      flex-direction: row;
      gap: $spacing-6;
    }
  }
  
  &__nav-item {
    margin: 0;
  }
  
  &__nav-link {
    display: block;
    padding: $spacing-3 $spacing-4;
    font-size: $font-size-base;
    font-weight: $font-weight-medium;
    color: var(--text-primary, #{map-get($light-theme, text-primary)});
    text-decoration: none;
    border-bottom: 3px solid var(--border-secondary, #{map-get($light-theme, border-secondary)});
    border-radius: 0;
    transition: all 0.3s ease;

    // Color por defecto (Pokédex - rojo)
    @include hover {
      color: #ffffff;
      background-color: #E3350D;
      border-bottom-color: #E3350D;
      border-radius: $border-radius-md;
    }

    // Modo oscuro - Pokédex
    :host-context(.dark-theme) & {
      @include hover {
        background-color: #862009;
        border-bottom-color: #862009;
      }
    }

    // Favoritos - rosa/rojo
    &--favoritos {
      @include hover {
        background-color: #FF3B5C;
        border-bottom-color: #FF3B5C;
      }

      // Modo oscuro - Favoritos
      :host-context(.dark-theme) & {
        @include hover {
          background-color: #CA022A;
          border-bottom-color: #CA022A;
        }
      }
    }

    // Quiz - amarillo
    &--quiz {
      @include hover {
        color: #1a1a1a;
        background-color: #E6BC2F;
        border-bottom-color: #E6BC2F;
      }

      // Modo oscuro - Quiz
      :host-context(.dark-theme) & {
        @include hover {
          background-color: #DBAE1A;
          border-bottom-color: #DBAE1A;
        }
      }
    }

    // Salir - rojo (solo móvil)
    &--logout {
      width: 100%;
      background: none;
      border: none;
      cursor: pointer;
      text-align: left;
      font-family: inherit;

      @include hover {
        color: #ffffff;
        background-color: #EF4444;
        border-bottom-color: #EF4444;
        border-radius: $border-radius-md;
      }

      // Modo oscuro - Salir
      :host-context(.dark-theme) & {
        @include hover {
          background-color: #DC2626;
          border-bottom-color: #DC2626;
        }
      }
    }

    @include respond-to('md') {
      padding: $spacing-2 $spacing-3;
    }
  }

  // Item de navegación solo visible en móvil
  &__nav-item--mobile-only {
    display: block;

    @include respond-to('md') {
      display: none;
    }
  }
  
  // ============================================================================
  //                    ELEMENTO: __actions (Botones de acción)
  // ============================================================================
  &__actions {
    display: flex;
    align-items: center;
    gap: $spacing-2;
    
    @include respond-to('md') {
      gap: $spacing-3;
    }
  }
  
  &__action-btn {
    @include flex-center;
    @include size(40px);
    background: transparent;
    border: 1px solid transparent;
    border-radius: $border-radius-full;
    color: var(--text-secondary, #{map-get($light-theme, text-secondary)});
    cursor: pointer;
    transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.2s ease;

    svg {
      @include size(20px);
    }

    @include hover {
      color: #3B82F6;
      background: rgba(59, 130, 246, 0.1);
      border-color: rgba(59, 130, 246, 0.2);
    }

    @include respond-to('md') {
      @include size(44px);

      svg {
        @include size(22px);
      }
    }
  }
  
  // Botón de búsqueda
  &__search-btn {
    // Oculto en móvil muy pequeño
    display: none;
    
    @include respond-to('sm') {
      display: flex;
    }
  }
  
  // Botón de tema
  &__theme-btn {
    background: var(--bg-tertiary, #{map-get($light-theme, bg-tertiary)});
  }
  
  // Botón de usuario
  &__user-btn {
    // Visible siempre
  }

  // Botón de logout (oculto en móvil, visible en desktop)
  &__logout-btn {
    display: none;
    color: var(--text-secondary, #{map-get($light-theme, text-secondary)});

    @include respond-to('md') {
      display: flex;
    }

    @include hover {
      color: #EF4444;
      background: rgba(239, 68, 68, 0.1);
      border-color: rgba(239, 68, 68, 0.2);
    }
  }

  // Modal de logout - Estilos similares al Quiz
  &__logout-modal-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: $spacing-5;
    padding: $spacing-2 0;
  }

  &__logout-modal-text {
    text-align: center;
    font-size: $font-size-lg;
    font-weight: $font-weight-semibold;
    color: #475569;
    margin: 0;

    .dark-theme & {
      color: #ffffff;
    }
  }

  &__logout-modal-actions {
    display: flex;
    justify-content: center;
    gap: $spacing-4;
    width: 100%;

    // Botones estilo Quiz
    ::ng-deep app-button {
      flex: 1;
      max-width: 160px;

      .button {
        width: 100%;
        padding: $spacing-3 $spacing-6;
        font-size: $font-size-base;
        font-weight: $font-weight-bold;
        border-radius: $border-radius-lg;
      }

      // Botón Aceptar - Modo claro: azul cyan
      .button--primary {
        background: #30A7D7;
        border-color: #30A7D7;
        color: #ffffff;

        &:hover:not(:disabled) {
          background: #2596C4;
          border-color: #2596C4;
        }
      }

      // Botón Cancelar - Modo claro: blanco con borde
      .button--secondary {
        background: #FFFFFF;
        border-color: #CBD5E1;
        color: #2F4467;

        &:hover:not(:disabled) {
          background: #F1F5F9;
          border-color: #94A3B8;
        }
      }
    }
  }

  // ============================================================================
  //        ELEMENTO: __auth-buttons (Botones de autenticación en landing)
  // ============================================================================
  &__auth-buttons {
    display: flex;
    align-items: center;
    gap: $spacing-3;
  }

  &__auth-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: $spacing-2 $spacing-4;
    font-size: $font-size-sm;
    font-weight: $font-weight-medium;
    text-decoration: none;
    border-radius: $border-radius-lg;
    transition: all 0.2s ease;
    white-space: nowrap;

    @include respond-to('md') {
      padding: $spacing-2 $spacing-5;
      font-size: $font-size-base;
    }

    // Botón "Inicia sesión" - estilo texto con hover gris
    &--login {
      background: transparent;
      color: var(--text-primary, #{map-get($light-theme, text-primary)});
      border: 1px solid transparent;

      &:hover {
        background: #e2e8f0;
        border-color: #cbd5e1;
        color: var(--text-primary, #{map-get($light-theme, text-primary)});
      }

      :host-context(.dark-theme) & {
        color: var(--text-primary, #{map-get($dark-theme, text-primary)});

        &:hover {
          background: rgba(255, 255, 255, 0.15);
          border-color: rgba(255, 255, 255, 0.3);
          color: #ffffff;
        }
      }
    }

    // Botón "Únete" - estilo azul sólido
    &--register {
      background: #3B82F6;
      color: #ffffff;
      border: 1px solid #3B82F6;

      &:hover {
        background: #2563eb;
        border-color: #2563eb;
      }
    }
  }
  
  // ============================================================================
  //        ELEMENTO: __menu-btn (Menú hamburguesa - solo móvil)
  // ============================================================================
  &__menu-btn {
    @include flex-center;
    @include size(40px);
    background: transparent;
    border: none;
    cursor: pointer;
    padding: $spacing-2;
    
    @include respond-to('md') {
      display: none;
    }
  }
  
  &__menu-icon {
    position: relative;
    width: 24px;
    height: 18px;

    span {
      position: absolute;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--text-primary, #{map-get($light-theme, text-primary)});
      border-radius: 2px;
      transition: opacity 0.2s ease, transform 0.2s ease, top 0.2s ease, bottom 0.2s ease;

      &:nth-child(1) { top: 0; }
      &:nth-child(2) { top: 50%; transform: translateY(-50%); }
      &:nth-child(3) { bottom: 0; }
    }
    
    // MODIFICADOR: --open (icono X)
    &--open {
      span {
        &:nth-child(1) {
          top: 50%;
          transform: translateY(-50%) rotate(45deg);
        }
        &:nth-child(2) {
          opacity: 0;
          transform: translateX(-10px);
        }
        &:nth-child(3) {
          bottom: 50%;
          transform: translateY(50%) rotate(-45deg);
        }
      }
    }
  }
}

// ============================================================================
//                    ANIMACIONES OPTIMIZADAS (60fps)
// ============================================================================
// Solo usamos transform y opacity para máximo rendimiento

// Animación de entrada del menú móvil
@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// Animación de salida del menú móvil
@keyframes slideUp {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-10px);
  }
}

// ============================================================================
//                    MODAL DE LOGOUT - Overrides globales
// ============================================================================
// Estos estilos deben estar fuera del bloque .header para funcionar con ::ng-deep

// Ocultar el header del modal (elimina la línea divisora superior)
::ng-deep app-header .modal__header {
  display: none;
}

// Texto blanco en modo oscuro
::ng-deep .dark-theme .header__logout-modal-text {
  color: #ffffff !important;
}

// Botón Aceptar en modo oscuro: fondo blanco, texto azul oscuro
::ng-deep .dark-theme .header__logout-modal-actions .button--primary {
  background: #FFFFFF !important;
  border-color: #FFFFFF !important;
  color: #2F4467 !important;
  box-shadow: none !important;

  &:hover:not(:disabled) {
    background: #E2E8F0 !important;
    border-color: #E2E8F0 !important;
    box-shadow: none !important;
  }
}

// Botón Cancelar en modo oscuro: fondo oscuro, texto blanco para visibilidad
::ng-deep .dark-theme .header__logout-modal-actions .button--secondary {
  background: #1E293B !important;
  border-color: #475569 !important;
  color: #94A3B8 !important;
  box-shadow: none !important;

  &:hover:not(:disabled) {
    background: #334155 !important;
    border-color: #64748B !important;
    color: #FFFFFF !important;
    box-shadow: none !important;
  }
}