<!-- ============================================================================
     HEADER COMPONENT - Estructura semántica
     Elemento: <header> - Contiene el encabezado de la página
     ============================================================================ -->
<header class="header">
  <div class="header__container">
    
    <!-- ========== LOGO ========== -->
    <!-- El logo es un enlace a la página principal -->
    <a routerLink="/" class="header__logo" title="Ir a la página de inicio">
      <!-- Logo Pokéball -->
      <img
        src="favicon.png"
        alt=""
        class="header__logo-icon"
        aria-hidden="true">
      <span class="header__logo-text">{{ title }}</span>
    </a>
    
    <!-- ========== NAVEGACIÓN PRINCIPAL ========== -->
    <!-- Elemento semántico <nav> para la navegación (oculto en modo quiz, modal fullscreen o usuario no autenticado en app) -->
    @if (!isQuizMode && !modalStateService.isFullscreenModalOpen() && !hideNavigation) {
      <nav #mobileNav
           class="header__nav"
           [class.header__nav--open]="isMenuOpen"
           aria-label="Navegación principal"
           id="mobile-menu">
        <ul class="header__nav-list">
          @for (item of currentNavItems; track item.path) {
            <li class="header__nav-item">
              <a [routerLink]="item.path"
                 [fragment]="item.fragment"
                 class="header__nav-link"
                 [ngClass]="item.colorClass"
                 (click)="handleNavClick($event, item)">
                {{ item.label }}
              </a>
            </li>
          }
          <!-- Opción Salir en menú móvil (solo cuando está logueado) -->
          @if (showProfileIcon) {
            <li class="header__nav-item header__nav-item--mobile-only">
              <button
                class="header__nav-link header__nav-link--logout"
                (click)="openLogoutModal(); closeMenu()">
                Salir
              </button>
            </li>
          }
        </ul>
      </nav>
    }
    
    <!-- ========== ACCIONES DE UTILIDAD ========== -->
    <div class="header__actions">

      <!-- Botones de autenticación (solo en landing page) -->
      @if (isLandingPage) {
        <div class="header__auth-buttons">
          <a routerLink="/login" class="header__auth-btn header__auth-btn--login">
            Iniciar sesión
          </a>
          <a routerLink="/register" class="header__auth-btn header__auth-btn--register">
            Únete
          </a>
        </div>
      }

      <!-- Botón de tema (en rutas de la app) -->
      @if (showThemeButton) {
        <button class="header__action-btn header__theme-btn"
                (click)="toggleTheme()"
                [attr.aria-label]="themeService.isDarkTheme() ? 'Cambiar a tema claro' : 'Cambiar a tema oscuro'"
                type="button">
          <!-- Icono Sol (tema claro) - se muestra cuando el tema es oscuro -->
          @if (themeService.isDarkTheme()) {
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <circle cx="12" cy="12" r="5"/>
              <line x1="12" y1="1" x2="12" y2="3"/>
              <line x1="12" y1="21" x2="12" y2="23"/>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
              <line x1="1" y1="12" x2="3" y2="12"/>
              <line x1="21" y1="12" x2="23" y2="12"/>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
          }
          <!-- Icono Luna (tema oscuro) - se muestra cuando el tema es claro -->
          @if (!themeService.isDarkTheme()) {
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
          }
        </button>
      }

      <!-- Botones de autenticación (cuando no está logueado en rutas de la app) -->
      @if (isAppRoute && !isAuthenticated() && !isLandingPage) {
        <div class="header__auth-buttons">
          <a routerLink="/login" class="header__auth-btn header__auth-btn--login">
            Iniciar sesión
          </a>
          <a routerLink="/register" class="header__auth-btn header__auth-btn--register">
            Únete
          </a>
        </div>
      }

      <!-- Botón de usuario/perfil (solo cuando está logueado) -->
      @if (showProfileIcon) {
        <a routerLink="/profile"
           class="header__action-btn header__user-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
          <span class="sr-only">Mi perfil</span>
        </a>

        <!-- Botón de cerrar sesión (solo desktop) -->
        <button
          class="header__action-btn header__logout-btn"
          (click)="openLogoutModal()"
          type="button">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          <span class="sr-only">Cerrar sesión</span>
        </button>
      }

      <!-- Botón menú hamburguesa (solo móvil, en rutas de la app) -->
      @if (showHamburgerMenu) {
        <button #menuButton
                class="header__menu-btn"
                (click)="toggleMenu()"
                [attr.aria-expanded]="isMenuOpen"
                aria-controls="mobile-menu"
                aria-label="Abrir menú de navegación"
                type="button">
          <span class="header__menu-icon" [class.header__menu-icon--open]="isMenuOpen">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </button>
      }

    </div>

  </div>
</header>

<!-- Modal de confirmación de logout -->
@if (isLogoutModalOpen) {
  <app-modal
    [isOpen]="isLogoutModalOpen"
    [showCloseButton]="true"
    [closeOnOverlay]="true"
    [blockScroll]="true"
    size="sm"
    title="Cerrar sesión"
    (closed)="closeLogoutModal()">
    <div class="header__logout-modal-content">
      <p class="header__logout-modal-text">¿Quieres salir de la app?</p>
      <div class="header__logout-modal-actions">
        <app-button variant="primary" (click)="confirmLogout()">Aceptar</app-button>
        <app-button variant="secondary" (click)="closeLogoutModal()">Cancelar</app-button>
      </div>
    </div>
  </app-modal>
}